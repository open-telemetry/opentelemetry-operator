apiVersion: v1
kind: Pod
metadata:
  annotations:
    sidecar.opentelemetry.io/inject: "true"
    instrumentation.opentelemetry.io/inject-golang: "true"
    instrumentation.opentelemetry.io/golang-target-exec: /usr/local/bin/emojivoto-voting-svc
  labels:
    app: my-pod-with-sidecar
spec:
  containers:
    - name: voting-svc
    - name: otc-container
    - name: opentelemetry-auto-instrumentation
      image: keyval/otel-go-agent:v0.6.4
      env:
        - name: OTEL_TARGET_EXE
          value: /usr/local/bin/emojivoto-voting-svc
        - name: OTEL_TRACES_EXPORTER
          value: otlp
        - name: OTEL_EXPORTER_OTLP_ENDPOINT
          value: http://localhost:4317
        - name: OTEL_EXPORTER_OTLP_TIMEOUT
          value: "20"
        - name: OTEL_TRACES_SAMPLER
          value: parentbased_traceidratio
        - name: OTEL_TRACES_SAMPLER_ARG
          value: "0.85"
        - name: SPLUNK_TRACE_RESPONSE_HEADER_ENABLED
          value: "true"
        - name: OTEL_SERVICE_NAME
          value: my-deployment-with-sidecar
        - name: OTEL_RESOURCE_ATTRIBUTES_POD_NAME
        - name: OTEL_RESOURCE_ATTRIBUTES_NODE_NAME
        - name: OTEL_PROPAGATORS
          value: jaeger,b3
        - name: OTEL_RESOURCE_ATTRIBUTES
      volumeMounts:
        - name: kernel-debug
          mountPath: "/sys/kernel/debug"
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount

status:
  phase: Running
