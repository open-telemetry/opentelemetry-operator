apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: stateful-collector
status:
  readyReplicas: 1
  replicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: stateful-targetallocator
status:
  observedGeneration: 1
  readyReplicas: 1
  replicas: 1
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: stateful-targetallocator
  targetallocator.yaml: |
    allocation_strategy: consistent-hashing
    collector_selector:
      matchlabels:
        app.kubernetes.io/component: opentelemetry-collector
        app.kubernetes.io/instance: opentelemetry-operator-system.stateful
        app.kubernetes.io/managed-by: opentelemetry-operator
        app.kubernetes.io/part-of: opentelemetry
      matchexpressions: []
    config:
      global:
        scrape_interval: 30s
        scrape_protocols:
        - PrometheusProto
        - OpenMetricsText1.0.0
        - OpenMetricsText0.0.1
        - PrometheusText0.0.4
      scrape_configs:
      - job_name: otel-collector
        scrape_interval: 10s
        static_configs:
        - targets:
          - 0.0.0.0:8888
    filter_strategy: relabel-config
---
apiVersion: v1
data:
  collector.yaml: |
    exporters:
        debug: null
    receivers:
        jaeger:
            protocols:
                grpc: null
        prometheus:
            config:
                global:
                    scrape_interval: 30s
                    scrape_protocols:
                        - PrometheusProto
                        - OpenMetricsText1.0.0
                        - OpenMetricsText0.0.1
                        - PrometheusText0.0.4
            target_allocator:
                collector_id: ${POD_NAME}
                endpoint: http://stateful-targetallocator:80
                interval: 30s
    service:
        pipelines:
            traces:
                exporters:
                    - debug
                receivers:
                    - jaeger
kind: ConfigMap
metadata:
  name: stateful-collector-2687b61c
