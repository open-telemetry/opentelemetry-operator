apiVersion: chainsaw.kyverno.io/v1alpha1
kind: StepTemplate
metadata:
  name: wait-for-telemetry
spec:
  bindings:
    - name: collectorLabelSelector
      # Label selector for the collector pod
      value: "app.kubernetes.io/name=deployment-collector"
    - name: containerName
      # Name of the container to check logs in
      value: "otc-container"
    - name: retryTimeout
      # Timeout in seconds for retry logic
      value: "120"
    - name: retrySleep
      # Sleep duration in seconds between retries
      value: "5"
    - name: searchStrings
      # Strings to search for in the logs (multi-line string)
      value: ""
  try:
    - script:
        env:
          - name: LABEL_SELECTOR
            value: ($collectorLabelSelector)
          - name: CONTAINER_NAME
            value: ($containerName)
          - name: RETRY_TIMEOUT
            value: ($retryTimeout)
          - name: RETRY_SLEEP
            value: ($retrySleep)
          - name: SEARCH_STRINGS_ENV
            value: ($searchStrings)
        timeout: 2m
        content: ../../test-e2e-apps/scripts/check_pod_logs.sh

